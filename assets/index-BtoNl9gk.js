(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const z=1,ee="balanceDB",C="balance",te=1,ne="transactionDB",L="transaction",l={WELCOME_PAGE:"WELCOME_PAGE",MAIN_PAGE:"MAIN_PAGE",BALANCE_PAGE:"BALANCE_PAGE",TRANSACTION_PAGE:"TRANSACTION_PAGE",BALANCE_BLOCK:"BALANCE_BLOCK",DAY_LIMIT_BLOCK:"DAY_LIMIT_BLOCK",TRANSACTION_BLOCK:"TRANSACTION_BLOCK"},w={CHANGE_PAGE:"CHANGE_PAGE",INIT_BALANCE:"INIT_BALANCE",BALANCE_UPDATED:"BALANCE_UPDATED",TRANSACTION_UPDATED:"TRANSACTION_UPDATED"},U={INIT_BALANCE:"INIT_BALANCE"};class ae{constructor(e,t,n){this.store=e,this.router=t,this.events=n}async start(){this.bindEvents(),await this.store.init(),await this.router.go(this.store.isWelcomeCompleted()?l.MAIN_PAGE:l.WELCOME_PAGE)}destroy(){this.router.destroy()}bindEvents(){this.events.on(w.INIT_BALANCE,async()=>{await this.router.go(l.MAIN_PAGE)}),this.events.on(w.CHANGE_PAGE,async e=>{typeof e.page=="string"&&await this.router.go(e.page)})}}function m(){const a=new Date;return a.setHours(0,0,0,0),a}function se(){const a=m();return a.setDate(a.getDate()+1),a}function oe(){const a=m();return a.setDate(a.getDate()+7),a}function ie(){const a=m();return a.setDate(a.getDate()+14),a}function ce(){const a=m();return a.setMonth(a.getMonth()+1),a}function re(){const a=m();return new Date(a.getFullYear(),a.getMonth()+1,0)}function B(a,e){return Math.floor((a.getTime()-e.getTime())/(1e3*60*60*24))*-1}const de="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let q=(a=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(a|=0));for(;a--;)e+=de[t[a]&63];return e};const S=(a,e)=>e.some(t=>a instanceof t);let R,V;function le(){return R||(R=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function he(){return V||(V=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const k=new WeakMap,P=new WeakMap,A=new WeakMap;function ue(a){const e=new Promise((t,n)=>{const s=()=>{a.removeEventListener("success",o),a.removeEventListener("error",i)},o=()=>{t(D(a.result)),s()},i=()=>{n(a.error),s()};a.addEventListener("success",o),a.addEventListener("error",i)});return A.set(e,a),e}function me(a){if(k.has(a))return;const e=new Promise((t,n)=>{const s=()=>{a.removeEventListener("complete",o),a.removeEventListener("error",i),a.removeEventListener("abort",i)},o=()=>{t(),s()},i=()=>{n(a.error||new DOMException("AbortError","AbortError")),s()};a.addEventListener("complete",o),a.addEventListener("error",i),a.addEventListener("abort",i)});k.set(a,e)}let x={get(a,e,t){if(a instanceof IDBTransaction){if(e==="done")return k.get(a);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return D(a[e])},set(a,e,t){return a[e]=t,!0},has(a,e){return a instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in a}};function J(a){x=a(x)}function pe(a){return he().includes(a)?function(...e){return a.apply(O(this),e),D(this.request)}:function(...e){return D(a.apply(O(this),e))}}function ve(a){return typeof a=="function"?pe(a):(a instanceof IDBTransaction&&me(a),S(a,le())?new Proxy(a,x):a)}function D(a){if(a instanceof IDBRequest)return ue(a);if(P.has(a))return P.get(a);const e=ve(a);return e!==a&&(P.set(a,e),A.set(e,a)),e}const O=a=>A.get(a);function we(a,e,{blocked:t,upgrade:n,blocking:s,terminated:o}={}){const i=indexedDB.open(a,e),c=D(i);return n&&i.addEventListener("upgradeneeded",r=>{n(D(i.result),r.oldVersion,r.newVersion,D(i.transaction),r)}),t&&i.addEventListener("blocked",r=>t(r.oldVersion,r.newVersion,r)),c.then(r=>{o&&r.addEventListener("close",()=>o()),s&&r.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}const be=["get","getKey","getAll","getAllKeys","count"],fe=["put","add","delete","clear"],T=new Map;function H(a,e){if(!(a instanceof IDBDatabase&&!(e in a)&&typeof e=="string"))return;if(T.get(e))return T.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,s=fe.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(s||be.includes(t)))return;const o=async function(i,...c){const r=this.transaction(i,s?"readwrite":"readonly");let d=r.store;return n&&(d=d.index(c.shift())),(await Promise.all([d[t](...c),s&&r.done]))[0]};return T.set(e,o),o}J(a=>({...a,get:(e,t,n)=>H(e,t)||a.get(e,t,n),has:(e,t)=>!!H(e,t)||a.has(e,t)}));const ge=["continue","continuePrimaryKey","advance"],Y={},W=new WeakMap,Q=new WeakMap,De={get(a,e){if(!ge.includes(e))return a[e];let t=Y[e];return t||(t=Y[e]=function(...n){W.set(this,Q.get(this)[e](...n))}),t}};async function*Ee(...a){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...a)),!e)return;e=e;const t=new Proxy(e,De);for(Q.set(t,e),A.set(t,O(e));e;)yield t,e=await(W.get(t)||e.continue()),W.delete(t)}function j(a,e){return e===Symbol.asyncIterator&&S(a,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&S(a,[IDBIndex,IDBObjectStore])}J(a=>({...a,get(e,t,n){return j(e,t)?Ee:a.get(e,t,n)},has(e,t){return j(e,t)||a.has(e,t)}}));class M{#e=null;constructor(e){this.#e=e}static async open(e,t,n){if(!("indexedDB"in window))throw new Error("IndexedDB Ð½Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð¾Ð¼");const s=await we(e,t,{upgrade(o,i,c){n?.(o,i,c)}});return new M(s)}get(e,t){return this.#t(),this.#e.get(e,t)}getAll(e){return this.#t(),this.#e.getAll(e)}put(e,t,n){return this.#t(),n!==void 0?this.#e.put(e,t,n):this.#e.put(e,t)}delete(e,t){return this.#t(),this.#e.delete(e,t)}clear(e){return this.#t(),this.#e.clear(e)}#t(){if(!this.#e)throw new Error("Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð½Ðµ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð°")}}const G=M.open(ee,z,a=>{a.objectStoreNames.contains(C)||a.createObjectStore(C,{keyPath:"id"})});async function F(a){const e=await G,t=a.id??q(),n={...a,id:t};return await e.put(C,n),n}async function ye(a){return(await G).get(C,a)}async function Ce(){return(await G).getAll(C)}const I=M.open(ne,te,a=>{a.objectStoreNames.contains(L)||a.createObjectStore(L,{keyPath:"id"})});async function Le(a){const e=await I,t=q(),n={...a,id:t};return await e.put(L,n),t}async function _e(a){return(await I).get(L,a)}async function Be(){return(await I).getAll(L)}class Ne{events;balanceModel;transactionModel;initBalanceCompleted=!1;constructor(e,t,n){this.events=e,this.balanceModel=t,this.transactionModel=n,this.initBalanceCompleted=localStorage.getItem(U.INIT_BALANCE)==="true",this.initBalanceCompleted||this.events.on(w.INIT_BALANCE,()=>{this.completeWelcome()})}isWelcomeCompleted(){return this.initBalanceCompleted}async init(){await this.initBalance(),await this.initTransactions()}completeWelcome(){this.initBalanceCompleted=!0,localStorage.setItem(U.INIT_BALANCE,"true")}async initTransactions(){try{const e=await Be();this.transactionModel.setTransactions(e)}catch(e){console.error(e)}}async initBalance(){try{const e=await ye(m().toISOString());if(e)this.balanceModel.updateBalance(e);else{const t=await Ce();if(t.length===0)await F(this.balanceModel.getBalanceData());else{const s={...t[t.length-1],id:m().toISOString(),wasted:0};await F(s),this.balanceModel.updateBalance(s)}}}catch(e){console.error(e)}}}class Ae{constructor(e){this.screens=e}current=null;async go(e){const t=this.screens[e];t&&(this.current!==t&&(this.current?.leave(),this.current=t),await t.enter(e))}destroy(){this.current?.leave(),this.current=null}}class Me{welcomePagePresenter;constructor(e){this.welcomePagePresenter=e}enter(){this.welcomePagePresenter.init()}leave(){this.welcomePagePresenter.destroy()}}class Ie{constructor(e,t,n){this.balancePresenter=e,this.dayLimitPresenter=t,this.transactionPresenter=n}enter(e){switch(e){case l.BALANCE_PAGE:{this.dayLimitPresenter.destroy(),this.transactionPresenter.destroy(),this.balancePresenter.initOverflow();break}case l.TRANSACTION_PAGE:{this.balancePresenter.destroy(),this.dayLimitPresenter.destroy(),this.transactionPresenter.initOverflow();break}default:this.balancePresenter.overflowDestroy(),this.transactionPresenter.overflowDestroy(),this.balancePresenter.init(),this.dayLimitPresenter.init(),this.transactionPresenter.init()}}leave(){this.balancePresenter.destroy(),this.dayLimitPresenter.destroy(),this.transactionPresenter.destroy()}}class Pe{_events;constructor(){this._events=new Map}on(e,t){this._events.has(e)||this._events.set(e,new Set),this._events.get(e)?.add(t)}off(e,t){this._events.has(e)&&(this._events.get(e).delete(t),this._events.get(e)?.size===0&&this._events.delete(e))}emit(e,t){this._events.forEach((n,s)=>{s==="*"&&n.forEach(o=>o({eventName:e,data:t})),(s instanceof RegExp&&s.test(e)||s===e)&&n.forEach(o=>o(t))})}onAll(e){this.on("*",e)}offAll(){this._events=new Map}trigger(e,t){return(n={})=>{this.emit(e,{...n||{},...t||{}})}}}class Te{events;balanceModel;transactionModel;constructor(e,t,n){this.events=e,this.balanceModel=t,this.transactionModel=n}getBalance(){return this.balanceModel.getBalanceData()}getBalanceLimit(){const e=this.balanceModel.getBalanceData();return{inLimit:e.dayLimit-e.wasted>=0,remained:e.dayLimit-e.wasted,limit:e.dayLimit,wasted:e.wasted}}async upBalance(e,t){const n=this.balanceModel.getBalanceData(),s=B(m(),t),o=n.value+e,i={id:n.id,endDate:t.toISOString(),value:o,wasted:n.wasted,dayLimit:o/s,avgDayWasted:n.avgDayWasted};await this.saveBalanceInDB(i),this.balanceModel.updateBalance(i),this.events.emit(w.BALANCE_UPDATED)}async initBalance(e,t){const n=B(m(),t),s={id:m().toISOString(),endDate:t.toISOString(),value:e,wasted:0,dayLimit:e/n,avgDayWasted:0};await this.saveBalanceInDB(s),this.balanceModel.updateBalance(s)}async addTransaction(e){const t=await this.saveTransactionInDB(e),n=await this.getTransactionByIdInDB(t);if(!n)throw new Error("Transaction not found");this.transactionModel.createTransaction(n),this.events.emit(w.TRANSACTION_UPDATED),await this.addWasted(n.value)}getTransactions(){return this.transactionModel.getTransactions()}getTransactionsCount(){return this.transactionModel.getTransactionsCount()}async addWasted(e){const t=this.balanceModel.getBalanceData(),n=this.transactionModel.getTransactionsCount();if(e>t.value)throw new Error("Wasted cannot be greater than value");let s={...t,value:t.value-e,wasted:t.wasted+e,avgDayWasted:t.wasted/n};if(t.dayLimit-t.wasted<=0){const o=B(m(),new Date(s.endDate));s={...s,dayLimit:s.value/o}}await this.saveBalanceInDB(s),this.balanceModel.updateBalance(s),this.events.emit(w.BALANCE_UPDATED)}async saveBalanceInDB(e){return await F(e)}async saveTransactionInDB(e){return await Le(e)}async getTransactionByIdInDB(e){return await _e(e)}}class Se{date=m();endDate=m();value=0;wasted=0;dayLimit=0;avgDayWasted=0;getBalanceData(){return{id:this.date.toISOString(),endDate:this.endDate.toISOString(),value:this.value,wasted:this.wasted,dayLimit:this.dayLimit,avgDayWasted:this.avgDayWasted}}updateBalance(e){this.endDate=new Date(e.endDate),this.value=e.value,this.wasted=e.wasted,this.dayLimit=e.dayLimit,this.avgDayWasted=e.avgDayWasted}}class ke{transactions=[];setTransactions(e){this.transactions=[...e].sort(this.sortByDateDesc)}getTransactions(){return this.transactions}getTransaction(e){return this.transactions.find(t=>t.id===e)}getTransactionsCount(){return this.transactions.length}createTransaction(e){this.transactions.unshift(e)}deleteTransaction(e){this.transactions=this.transactions.filter(t=>t.id!==e)}sortByDateDesc(e,t){return new Date(t.date).getTime()-new Date(e.date).getTime()}}function N(a){return new Intl.DateTimeFormat("ru-RU",{day:"numeric",month:"long"}).format(a)}function xe(a){return new Intl.DateTimeFormat("ru-RU",{day:"numeric",month:"numeric",year:"numeric"}).format(a)}const Oe="data:image/svg+xml,%3csvg%20width='18'%20height='10'%20viewBox='0%200%2018%2010'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0.75%200.75L8.75%208.75L16.75%200.75'%20stroke='%236B7280'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3c/svg%3e";class We{hiddenInput=void 0;selector=void 0;dropdown=void 0;input=void 0;button=void 0;name="";title="";placeholder="";options=[];constructor(e){this.name=e.name,this.title=e.title,this.placeholder=e.placeholder,this.options=e.options??[];const t=document.createElement("fieldset");t.classList.add("selector");const n=document.createElement("legend");n.classList.add("selector__title","caption"),n.textContent=this.title;const s=document.createElement("input");s.classList.add("selector__input"),s.placeholder=this.placeholder,s.name="input",s.readOnly=!0,this.input=s;const o=document.createElement("input");o.type="hidden",o.name=this.name,this.hiddenInput=o;const i=document.createElement("button");i.classList.add("selector__drop_button"),i.type="button";const c=document.createElement("img");c.classList.add("selector__drop_button-img"),c.src=Oe,c.alt="dropdown button",i.appendChild(c),this.button=i;const r=document.createElement("div");r.classList.add("dropdown_menu"),t.append(n,s,o,i,r),this.selector=t,this.dropdown=r,this.selector.addEventListener("click",this.onButtonClick.bind(this)),this.dropdown.addEventListener("click",this.onDropdownItemClick.bind(this)),document.addEventListener("click",this.onDocumentClick.bind(this))}destroy(){this.selector?.removeEventListener("click",this.onButtonClick.bind(this)),this.dropdown?.removeEventListener("click",this.onDropdownItemClick.bind(this)),document.removeEventListener("click",this.onDocumentClick.bind(this))}getNode(){return this.selector||document.createElement("fieldset")}openDropdown(){this.dropdown&&(this.dropdown.replaceChildren(),this.renderOptions(this.dropdown),this.dropdown.classList.add("dropdown_menu-visible"))}closeDropdown(){this.dropdown&&this.dropdown.classList.remove("dropdown_menu-visible")}renderOptions(e){this.options.forEach(t=>{const n=document.createElement("button");n.type="button",n.classList.add("dropdown_menu--item"),n.dataset.value=t.value,n.textContent=t.label,e.appendChild(n)})}onDropdownItemClick=e=>{e.stopPropagation();const n=e.target.closest("[data-value]");!n||!this.input||!this.hiddenInput||!this.dropdown||(this.input.value=n.dataset.value??"",this.hiddenInput.value=n.value??"",n.dataset.option!=="offOnDropdownClick"&&this.dropdown.classList.remove("dropdown_menu-visible"))};onButtonClick(e){e.stopPropagation();const t=e.target;!this.dropdown||!this.button||!this.input||this.dropdown.contains(t)||(t===this.input||this.button.contains(t))&&(this.dropdown.classList.contains("dropdown_menu-visible")?this.closeDropdown():this.openDropdown())}onDocumentClick(e){const t=e.target;(!this.selector||!this.selector.contains(t))&&this.dropdown?.classList.remove("dropdown_menu-visible")}}class X extends We{dateSelector=null;baseOptions={nextDay:{value:se(),label:"Ð”ÐµÐ½ÑŒ"},nextWeek:{value:oe(),label:"ÐÐµÐ´ÐµÐ»Ñ"},nextTwoWeek:{value:ie(),label:"Ð”Ð²Ðµ Ð½ÐµÐ´ÐµÐ»Ð¸"},nextMonth:{value:ce(),label:"ÐœÐµÑÑÑ†"},lastDayOfMonth:{value:re(),label:"Ð”Ð¾ ÐºÐ¾Ð½Ñ†Ð° Ð¼ÐµÑÑÑ†Ð°"}};constructor(e,t){super(e),this.dateSelector=t}setValue(e,t){const n=typeof e=="string"?new Date(e):new Date(e);Number.isNaN(n.getTime())||(n.setHours(23,59,59,999),this.dateSelector?.setDefaultValue(n),this.input&&this.hiddenInput&&(this.input.value=t??`Ð´Ð¾ ${N(n)}`,this.hiddenInput.value=n.toISOString()??""))}openDropdown(){super.openDropdown(),this.dropdown&&this.dropdown.addEventListener("click",this.onDropdownCalendarClick.bind(this))}closeDropdown(){super.closeDropdown(),this.dropdown&&this.dropdown.removeEventListener("click",this.onDropdownCalendarClick.bind(this))}renderCalendar(e){if(!this.dateSelector)return;e.replaceChildren();const t=this.dateSelector.getNode();e.appendChild(t)}renderOptions(e){e.replaceChildren();const t=()=>{const i=document.createElement("button"),c=document.createElement("span"),r=document.createElement("span");return i.type="button",i.classList.add("dropdown_menu--item"),{item:i,span1:c,span2:r}};Object.entries(this.baseOptions).forEach(([i,c])=>{const{item:r,span1:d,span2:h}=t();d.textContent=c.label,h.textContent=`Ð´Ð¾ ${N(c.value)}`,c.value.setHours(23,59,59,999),r.value=c.value.toISOString().toString(),r.dataset.key=i,r.dataset.value=`${c.label} (Ð´Ð¾ ${N(c.value)})`,r.append(d,h),e.appendChild(r)});const{item:n,span1:s,span2:o}=t();s.textContent="Ð¡Ð²Ð¾Ñ Ð´Ð°Ñ‚Ð°",n.value="customDate",n.dataset.key="customDate",n.dataset.value="Ð¡Ð²Ð¾Ñ Ð´Ð°Ñ‚Ð°",n.dataset.option="offOnDropdownClick",n.append(s,o),e.appendChild(n)}onDropdownCalendarClick=e=>{if(e.stopPropagation(),!this.dropdown)return;const n=e.target.closest(".dropdown_menu--item");n&&n.dataset.key==="customDate"&&this.renderCalendar(this.dropdown)}}const Fe="data:image/svg+xml,%3csvg%20width='10'%20height='18'%20viewBox='0%200%2010%2018'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0.75%2016.75L8.75%208.75L0.749999%200.749999'%20stroke='%23111827'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3c/svg%3e",Ge="data:image/svg+xml,%3csvg%20width='10'%20height='18'%20viewBox='0%200%2010%2018'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9.06055%200.75L1.06055%208.75L9.06055%2016.75'%20stroke='%236B7280'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3c/svg%3e",$="data:image/svg+xml,%3csvg%20width='10'%20height='18'%20viewBox='0%200%2010%2018'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9.06055%200.75L1.06055%208.75L9.06055%2016.75'%20stroke='%23111827'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3c/svg%3e";class Z{calendarNode;datePickerNode;prevButtonNode;nextButtonNode;currentDate=m();selectedDate=m();formatterDay=new Intl.DateTimeFormat("ru-RU",{day:"numeric"});formatterMount=new Intl.DateTimeFormat("ru-RU",{day:"numeric",month:"long"});constructor(){this.currentDate.setHours(23,59,59,999),new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()+1,0,23,59,59).getDate()===this.currentDate.getDate()&&(this.selectedDate.setMonth(this.selectedDate.getMonth()+1),this.selectedDate.setDate(0)),this.createCalendarNode()}destroy(){this.prevButtonNode?.removeEventListener("click",this.handlePrevMount.bind(this)),this.nextButtonNode?.removeEventListener("click",this.handleNextMount.bind(this)),this.calendarNode?.remove(),this.calendarNode=void 0,this.prevButtonNode=void 0,this.nextButtonNode=void 0}getNode(){return this.calendarNode?this.calendarNode:document.createElement("div")}setDefaultValue(e){const t=typeof e=="string"?new Date(e):new Date(e);if(Number.isNaN(t.getTime()))return;t.setHours(23,59,59,999);const n=t<this.currentDate?new Date(this.currentDate):t,s=n.getFullYear(),o=n.getMonth(),i=n.getDate(),c=new Date(s,o+1,0,23,59,59,999).getDate(),r=Math.min(i,c);this.selectedDate=new Date(s,o,r,23,59,59,999),this.calendarNode&&this.updateDatePicker()}getMonthStart(e){return new Date(e.getFullYear(),e.getMonth(),1,0,0,0,0)}syncPrevButtonState(){if(!this.prevButtonNode)return;const e=this.getMonthStart(this.currentDate),t=this.getMonthStart(this.selectedDate);t.setMonth(t.getMonth()-1);const n=t<e;this.prevButtonNode.disabled=n;const s=document.createElement("img");n?(s.src=Ge,this.prevButtonNode.replaceChildren(s)):(s.src=$,this.prevButtonNode.replaceChildren(s))}getMonthWeeks(e,t){const n=[];let s=[];const o=new Date(e,t,1),i=new Date(e,t+1,0);o.setHours(0,0,0,0),i.setHours(23,59,59,999);const c=(o.getDay()+6)%7;for(let r=0;r<c;r++)s.push(null);for(let r=1;r<=i.getDate();r++){const d=new Date(e,t,r);d.setHours(23,59,59,999),s.push(d),s.length===7&&(n.push(s),s=[])}if(s.length>0){for(;s.length<7;)s.push(null);n.push(s)}return n}updateDatePicker(){if(!this.calendarNode||!this.datePickerNode)return;const e=this.calendarNode.querySelector(".calendar__title"),t=document.createElement("h3"),n=document.createElement("h3");t.textContent=this.selectedDate.toLocaleString("ru-RU",{month:"long"}),n.textContent=this.selectedDate.toLocaleString("ru-RU",{year:"numeric"}),e?.replaceChildren(t,n);const s=this.getMonthWeeks(this.selectedDate.getFullYear(),this.selectedDate.getMonth()),o=this.getDatePickerNode(s);this.datePickerNode.replaceWith(o),this.datePickerNode=o,this.syncPrevButtonState()}handleNextMount(){const e=this.selectedDate.getFullYear(),t=this.selectedDate.getMonth();this.selectedDate.setDate(1),t===11?(this.selectedDate.setFullYear(e+1),this.selectedDate.setMonth(0)):this.selectedDate.setMonth(this.selectedDate.getMonth()+1),this.updateDatePicker()}handlePrevMount(){const e=this.selectedDate.getFullYear(),t=this.selectedDate.getMonth();this.selectedDate.setDate(1),t===0?(this.selectedDate.setFullYear(e-1),this.selectedDate.setMonth(11)):this.selectedDate.setMonth(this.selectedDate.getMonth()-1),this.updateDatePicker()}getDatePickerNode(e){const t=document.createElement("div");t.classList.add("date-picker");const n=document.createElement("div");n.classList.add("date-picker__week");for(let s=0;s<7;s++){const o=document.createElement("span");o.classList.add("date-picker__day-name"),o.textContent=["Ð¿Ð½","Ð²Ñ‚","ÑÑ€","Ñ‡Ñ‚","Ð¿Ñ‚","ÑÐ±","Ð²Ñ"][s],n.appendChild(o)}return t.appendChild(n),e.forEach(s=>{const o=document.createElement("div");o.classList.add("date-picker__week"),s.forEach(i=>{const c=document.createElement("button");c.classList.add("date-picker__day"),c.type="button",i?(c.value=i.toISOString().toString(),c.textContent=this.formatterDay.format(i),c.dataset.value=`Ð´Ð¾ ${this.formatterMount.format(i)}`,i<this.currentDate&&(c.classList.add("date-picker__day--no-active"),c.tabIndex=-1,c.disabled=!0)):(c.classList.add("date-picker__day--no-active"),c.tabIndex=-1,c.disabled=!0),o.appendChild(c)}),t.appendChild(o)}),t}createCalendarNode(){const e=document.createElement("div");e.classList.add("calendar");const t=document.createElement("div");t.classList.add("calendar__body");const n=document.createElement("div"),s=document.createElement("h3"),o=document.createElement("h3");n.classList.add("calendar__title"),s.textContent=this.selectedDate.toLocaleString("ru-RU",{month:"long"}),o.textContent=this.selectedDate.toLocaleString("ru-RU",{year:"numeric"}),n.appendChild(s),n.appendChild(o),t.appendChild(n);const i=this.getMonthWeeks(this.selectedDate.getFullYear(),this.selectedDate.getMonth()),c=this.getDatePickerNode(i);t.appendChild(c),e.appendChild(t);const r=document.createElement("button"),d=document.createElement("button"),h=document.createElement("img"),u=document.createElement("img");r.classList.add("calendar__btn","calendar__prev"),d.classList.add("calendar__btn","calendar__next"),r.type="button",d.type="button",h.src=$,u.src=Fe,r.appendChild(h),d.appendChild(u),e.appendChild(r),e.appendChild(d),this.prevButtonNode=r,this.nextButtonNode=d,this.datePickerNode=c,this.calendarNode=e,this.syncPrevButtonState(),r.addEventListener("click",this.handlePrevMount.bind(this)),d.addEventListener("click",this.handleNextMount.bind(this))}}function E(a){const e=a.target;e.value=e.value.replace(/[^0-9]/g,"")}function y(a){const e=a.target;e.value=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",maximumFractionDigits:0}).format(Number(e.value))}function v(a){return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",maximumFractionDigits:0}).format(a)}function K(a){const e=/\D/gi;return Number(a.replace(e,""))}class Ke{events;accountModel;view;cardNode=void 0;constructor(e,t,n){this.accountModel=e,this.view=t,this.events=n,this.events.on(w.BALANCE_UPDATED,()=>{this.balanceUpdate()})}init(){const e=this.accountModel.getBalance(),t=document.createElement("div");t.classList.add("card-block");const n=document.createElement("div");n.classList.add("card__title");const s=document.createElement("h3");s.classList.add("card__title-left"),s.textContent="ÐžÐ±Ñ‰Ð¸Ð¹ Ð±Ð°Ð»Ð°Ð½Ñ";const o=document.createElement("span");o.classList.add("card__title-right"),o.textContent=`${v(e.dayLimit)} Ð² Ð´ÐµÐ½ÑŒ`,n.appendChild(s),n.appendChild(o),t.appendChild(n);const i=document.createElement("div");i.classList.add("card__body");const c=document.createElement("div");c.classList.add("balance-block");const r=B(new Date(e.id),new Date(e.endDate)),d=document.createElement("h1");d.classList.add("balance-block__balance"),d.textContent=v(e.value);const h=document.createElement("span");h.classList.add("balance-block__day"),h.textContent=`Ð½Ð° ${r} Ð´Ð½ÐµÐ¹`,c.appendChild(d),c.appendChild(h),i.appendChild(c);const u=document.createElement("button");u.classList.add("btn","balance-block__change-button"),u.textContent="Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ",i.appendChild(u),t.appendChild(i),u.addEventListener("click",this.handleChangeBalance.bind(this)),this.cardNode=t,this.view.addChildWithKey(l.BALANCE_BLOCK,t),this.destroyData=()=>{u.removeEventListener("click",this.handleChangeBalance.bind(this)),this.view.unmount(l.BALANCE_BLOCK)}}destroy(){this.destroyData()}initOverflow(){this.view.unmount(l.BALANCE_BLOCK);const e=this.accountModel.getBalance(),t=document.createElement("div");t.classList.add("card-block","card-block--overflow");const n=document.createElement("div");n.classList.add("card__title");const s=document.createElement("h3");s.classList.add("card__title-left"),s.textContent="ÐžÐ±Ñ‰Ð¸Ð¹ Ð±Ð°Ð»Ð°Ð½Ñ";const o=document.createElement("span");o.classList.add("card__title-right"),o.textContent=`${v(e.dayLimit)} Ð² Ð´ÐµÐ½ÑŒ`,n.appendChild(s),n.appendChild(o),t.appendChild(n);const i=document.createElement("div");i.classList.add("card__body");const c=document.createElement("form");c.name="change-balance",c.classList.add("form","form--change-balance");const r=document.createElement("label");r.classList.add("input");const d=document.createElement("span");d.classList.add("input__title","caption"),d.textContent="Ð’Ð°Ñˆ Ð±Ð°Ð»Ð°Ð½Ñ";const h=document.createElement("input");h.name="balance",h.classList.add("input__input"),h.disabled=!0,h.placeholder="Ð’Ð°Ñˆ Ð±Ð°Ð»Ð°Ð½Ñ",h.value=v(e.value),r.append(d,h);const u=document.createElement("label");u.classList.add("input");const f=document.createElement("span");f.classList.add("input__title","caption"),f.textContent="ÐŸÐ¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ";const p=document.createElement("input");p.name="up-balance",p.classList.add("input__input"),p.placeholder="ÐŸÐ¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ",p.value=v(0),p.addEventListener("input",E),p.addEventListener("change",y),u.append(f,p);const b=new Z,g=new X({name:"term",title:"ÐÐ° ÑÑ€Ð¾Ðº",placeholder:"Ð’Ñ‹Ð±Ð¾Ñ€ Ð´Ð°Ñ‚Ñ‹"},b);g.setValue(e.endDate);const _=document.createElement("button");_.classList.add("btn","btn--primary","form__submit--change-balance"),_.textContent="ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ",_.type="submit",c.append(r,u,g.getNode(),_),i.appendChild(c),t.appendChild(i),c.addEventListener("submit",this.handleSubmitForm.bind(this)),this.view.addChildWithKey(l.BALANCE_PAGE,t),this.overflowDestroyData=()=>{p.removeEventListener("input",E),p.removeEventListener("change",y),c.removeEventListener("submit",this.handleSubmitForm.bind(this)),this.view.unmount(l.BALANCE_PAGE)}}overflowDestroy(){this.overflowDestroyData()}async handleSubmitForm(e){e.preventDefault();const t=document.forms.namedItem("change-balance");if(!t)throw new Error("Form is not defined");const n=t.elements.namedItem("up-balance"),s=t.elements.namedItem("term");!n||!s||("value"in n&&"value"in s&&await this.accountModel.upBalance(K(n.value),new Date(s.value)),this.events.emit(w.CHANGE_PAGE,{page:l.MAIN_PAGE}))}handleChangeBalance(e){e.preventDefault(),this.events.emit(w.CHANGE_PAGE,{page:l.BALANCE_PAGE})}balanceUpdate(){if(!this.cardNode)throw new Error("Card node is not defined");const e=this.accountModel.getBalance(),t=this.cardNode.querySelector(".balance-block__balance"),n=this.cardNode.querySelector(".card__title-right");if(!t||!n)throw new Error("Balance/Day-limit node is not defined");t.textContent=v(e.value),n.textContent=v(e.dayLimit)}destroyData=()=>{};overflowDestroyData=()=>{}}class Ue{events;accountModel;view;cardNode=void 0;constructor(e,t,n){this.accountModel=e,this.view=t,this.events=n,this.events.on(w.BALANCE_UPDATED,()=>{this.balanceUpdate(),this.commentUpdate()})}init(){const e=this.accountModel.getBalance(),t=document.createElement("div");t.classList.add("card-block");const n=document.createElement("div");n.classList.add("card__title");const s=document.createElement("h3");s.classList.add("card__title-left"),s.textContent="ÐÐ° ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾",n.appendChild(s),t.appendChild(n);const o=document.createElement("div");o.classList.add("card__body");const i=document.createElement("div");i.classList.add("balance-block");const c=document.createElement("h1");c.classList.add("balance-block__balance");const r=document.createElement("span");r.classList.add("balance-block__balance--wasted"),r.textContent=v(e.wasted);const d=document.createElement("span");d.classList.add("balance-block__balance--available"),d.textContent=v(e.dayLimit),c.appendChild(r),c.appendChild(d),i.appendChild(c),o.appendChild(i);const h=document.createElement("p");h.classList.add("balance-block__wasted-comment"),o.appendChild(h);const u=document.createElement("form");u.name="form-wasted",u.classList.add("form","form--day-limit");const f=document.createElement("label");f.classList.add("input");const p=document.createElement("span");p.classList.add("input__title","caption"),p.textContent="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ‚Ñ€Ð°Ñ‚Ñƒ";const b=document.createElement("input");b.name="wasted",b.classList.add("input__input"),b.placeholder="0 â‚½",b.addEventListener("input",E),b.addEventListener("change",y),f.append(p,b);const g=document.createElement("button");g.classList.add("btn","btn--primary","balance-block__change-button"),g.textContent="Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ",g.type="submit",u.append(f,g),o.appendChild(u),t.appendChild(o),u.addEventListener("submit",this.handleSubmitForm.bind(this)),this.cardNode=t,this.balanceUpdate(),this.commentUpdate(),this.view.addChildWithKey(l.DAY_LIMIT_BLOCK,t),this.destroyData=()=>{this.cardNode?.classList.toggle("card-block--hidden"),this.view.unmount(l.DAY_LIMIT_BLOCK),b.removeEventListener("input",E),b.removeEventListener("change",y),u.removeEventListener("submit",this.handleSubmitForm.bind(this))}}destroy(){this.destroyData()}async handleSubmitForm(e){e.preventDefault();const t=document.forms.namedItem("form-wasted");if(!t)throw new Error("Form is not defined");const n=t.elements.namedItem("wasted");if(!n||!(n instanceof HTMLInputElement))throw new Error("Wasted is not defined");if("value"in n){const s={value:K(n.value),date:m().toISOString()};await this.accountModel.addTransaction(s),n.value="",n.placeholder="0 â‚½"}}balanceUpdate(){if(!this.cardNode)throw new Error("Card node is not defined");const e=this.cardNode.querySelector(".balance-block__balance--wasted"),t=this.cardNode.querySelector(".balance-block__balance--available");if(!e||!t)throw new Error("Balance block is not defined");const n=this.accountModel.getBalanceLimit();t.textContent=v(n.limit),e.textContent=v(n.remained),e.classList.remove(),n.remained>=0?e.classList.add("balance-block__balance--remained--success"):e.classList.add("balance-block__balance--remained--error")}commentUpdate(){if(!this.cardNode)throw new Error("Card node is not defined");const e=this.cardNode.querySelector(".balance-block__wasted-comment");if(!e)throw new Error("Comment block is not defined");this.accountModel.getBalanceLimit().inLimit?e.textContent="ðŸŽ‰ ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾ ÑÐ¿Ñ€Ð°Ð²Ð¸Ð»Ð¸ÑÑŒ â€” ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð²Ñ‹ Ð² Ð¿Ñ€ÐµÐ´ÐµÐ»Ð°Ñ… Ð»Ð¸Ð¼Ð¸Ñ‚Ð°!":e.textContent="âŒ Ð’Ñ‹ Ð¿Ñ€ÐµÐ²Ñ‹ÑÐ¸Ð»Ð¸ Ð»Ð¸Ð¼Ð¸Ñ‚ Ð½Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ!"}destroyData=()=>{}}class Re{events;accountModel;view;cardNode=void 0;constructor(e,t,n){this.accountModel=e,this.view=t,this.events=n,this.events.on(w.TRANSACTION_UPDATED,()=>{this.transactionsListUpdated(!1)})}init(){const e=this.accountModel.getBalance(),t=document.createElement("div");t.classList.add("card-block");const n=document.createElement("div");n.classList.add("card__title","card__title--wasted");const s=document.createElement("h2");s.classList.add("card__title-left"),s.textContent="Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ñ€Ð°ÑÑ…Ð¾Ð´Ð¾Ð²",n.appendChild(s),t.appendChild(n);const o=document.createElement("div");o.classList.add("card__body");const i=document.createElement("span");i.classList.add("card__body__title"),i.textContent=`Ð¡Ñ€ÐµÐ´Ð½Ð¸Ðµ Ñ‚Ñ€Ð°Ñ‚Ñ‹ Ð² Ð´ÐµÐ½ÑŒ: ${v(e.avgDayWasted)}`,o.appendChild(i);const c=document.createElement("div");c.classList.add("transactions-list"),o.appendChild(c);const r=document.createElement("button");r.classList.add("btn"),r.textContent="Ð¡Ð¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð²ÑÑŽ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ",o.appendChild(r),t.appendChild(o),r.addEventListener("click",this.handleViewFullHistory.bind(this)),this.cardNode=t,this.transactionsListUpdated(!1),this.view.addChildWithKey(l.TRANSACTION_BLOCK,t),this.destroyData=()=>{r.removeEventListener("click",this.handleViewFullHistory.bind(this)),this.view.unmount(l.TRANSACTION_BLOCK)}}destroy(){this.destroyData()}initOverflow(){this.view.unmount(l.TRANSACTION_BLOCK);const e=this.accountModel.getBalance(),t=document.createElement("div");t.classList.add("card-block","card-block--overflow");const n=document.createElement("div");n.classList.add("card__title","card__title--wasted");const s=document.createElement("h2");s.classList.add("card__title-left"),s.textContent="Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ñ€Ð°ÑÑ…Ð¾Ð´Ð¾Ð²",n.appendChild(s),t.appendChild(n);const o=document.createElement("div");o.classList.add("card__body");const i=document.createElement("span");i.classList.add("card__body__title"),i.textContent=`Ð¡Ñ€ÐµÐ´Ð½Ð¸Ðµ Ñ‚Ñ€Ð°Ñ‚Ñ‹ Ð² Ð´ÐµÐ½ÑŒ: ${v(e.avgDayWasted)}`,o.appendChild(i);const c=document.createElement("div");c.classList.add("transactions-list","transactions-list--full"),o.appendChild(c);const r=document.createElement("button");r.classList.add("btn"),r.textContent="Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð½Ð° Ð³Ð»Ð°Ð²Ð½ÑƒÑŽ",o.appendChild(r),t.appendChild(o),r.addEventListener("click",this.handelMoveToMainPage.bind(this)),this.cardNode=t,this.transactionsListUpdated(!0),this.view.addChildWithKey(l.TRANSACTION_BLOCK,t),this.destroyData=()=>{r.removeEventListener("click",this.handelMoveToMainPage.bind(this)),this.view.unmount(l.TRANSACTION_BLOCK)}}overflowDestroy(){this.overflowDestroyData()}handleViewFullHistory(e){e.preventDefault(),this.events.emit(w.CHANGE_PAGE,{page:l.TRANSACTION_PAGE})}handelMoveToMainPage(e){e.preventDefault(),this.events.emit(w.CHANGE_PAGE,{page:l.MAIN_PAGE})}transactionsListUpdated(e){if(!this.cardNode)throw new Error("Card node is not defined");const t=this.cardNode.querySelector(".transactions-list");if(!t)throw new Error("Transactions list node is not defined");t.replaceChildren();let n=this.accountModel.getTransactions();e||(n=n.slice(0,3)),n.forEach(s=>{const o=document.createElement("div");o.classList.add("transaction-card");const i=document.createElement("h3");i.classList.add("transaction-card__value"),i.textContent=v(s.value);const c=document.createElement("span");c.classList.add("transaction-card__date"),e?c.textContent=xe(new Date(s.date)):c.textContent=N(new Date(s.date)),o.appendChild(i),o.appendChild(c),t.appendChild(o)})}destroyData=()=>{};overflowDestroyData=()=>{}}class Ve{events;accountModel;view;constructor(e,t,n){this.accountModel=e,this.view=t,this.events=n}init(){const e=document.createElement("div");e.classList.add("card-block","card-block--welcome");const t=document.createElement("h1");t.classList.add("card__title"),t.textContent="ÐÐ°Ñ‡Ð½Ñ‘Ð¼!";const n=document.createElement("div");n.classList.add("card__body");const s=document.createElement("form");s.name="welcome",s.classList.add("form","form--welcome");const o=document.createElement("label");o.classList.add("input");const i=document.createElement("span");i.classList.add("input__title","caption"),i.textContent="Ð£ÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð±Ð°Ð»Ð°Ð½Ñ";const c=document.createElement("input");c.name="start-balance",c.classList.add("input__input"),c.placeholder="Ð¡Ñ‚Ð°Ñ€Ñ‚Ð¾Ð²Ñ‹Ð¹ Ð±Ð°Ð»Ð°Ð½Ñ",c.addEventListener("input",E),c.addEventListener("change",y),o.append(i,c);const r=new Z,d=new X({name:"term",title:"ÐÐ° ÑÑ€Ð¾Ðº",placeholder:"Ð’Ñ‹Ð±Ð¾Ñ€ Ð´Ð°Ñ‚Ñ‹"},r),h=document.createElement("button");h.classList.add("btn","btn--primary","form__submit--welcome"),h.textContent="Ð Ð°ÑÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ",h.type="submit",s.append(o,d.getNode(),h),n.appendChild(s),e.append(t,n),s.addEventListener("submit",this.handleSubmitForm.bind(this)),this.view.addChildWithKey(l.WELCOME_PAGE,e),this.destroyData=()=>{c.removeEventListener("input",E),c.removeEventListener("change",y),s.removeEventListener("submit",this.handleSubmitForm.bind(this)),r.destroy(),d.destroy(),this.view.unmount(l.WELCOME_PAGE)}}destroy(){this.destroyData()}async handleSubmitForm(e){e.preventDefault();const t=document.forms.namedItem("welcome");if(!t)throw new Error("Form is not defined");const n=t.elements.namedItem("start-balance"),s=t.elements.namedItem("term");!n||!s||"value"in n&&"value"in s&&(await this.accountModel.initBalance(K(n.value),new Date(s.value)),this.events.emit(w.INIT_BALANCE))}destroyData=()=>{}}class He{rootNode=document.getElementById("app");pageNode;contentNode;childrenByKey=new Map;constructor(){if(!this.rootNode)throw new Error("App root element #app not found");this.pageNode=document.createElement("div"),this.pageNode.classList.add("page"),this.contentNode=document.createElement("section"),this.contentNode.classList.add("main"),this.pageNode.appendChild(this.contentNode),this.rootNode.appendChild(this.pageNode)}mount(e,t){if(!t){this.contentNode.replaceChildren(e),this.childrenByKey.clear();return}const n=this.childrenByKey.get(t);n&&(n.remove(),this.childrenByKey.delete(t)),e.dataset.key=t,this.childrenByKey.set(t,e),this.contentNode.appendChild(e)}unmount(e){if(!e){const n=this.contentNode.childNodes.length>0;return this.contentNode.replaceChildren(),this.childrenByKey.clear(),n}const t=this.childrenByKey.get(e);return t?(t.remove(),this.childrenByKey.delete(e),!0):!1}addChild(e){this.contentNode.appendChild(e)}addChildWithKey(e,t){return this.mount(t,e),()=>this.unmount(e)}hasKey(e){return this.childrenByKey.has(e)}}async function Ye(){await I;const a=new Pe,e=new Se,t=new ke,n=new Te(a,e,t),s=new He,o=new Ve(n,s,a),i=new Ke(n,s,a),c=new Ue(n,s,a),r=new Re(n,s,a),d=new Ie(i,c,r),h={[l.WELCOME_PAGE]:new Me(o),[l.MAIN_PAGE]:d,[l.BALANCE_PAGE]:d,[l.TRANSACTION_PAGE]:d},u=new Ae(h),f=new Ne(a,e,t);await new ae(f,u,a).start()}document.addEventListener("DOMContentLoaded",async()=>{await Ye()});
//# sourceMappingURL=index-BtoNl9gk.js.map
